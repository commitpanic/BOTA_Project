{% extends "admin/index.html" %}
{% load i18n static %}

{% block content %}
<div id="content-main">
    
    {% if stats %}
    <div style="margin-bottom: 30px;">
        <h2>ğŸ“Š Statistics Overview</h2>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 20px;">
            <!-- Users Stats -->
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <h3 style="margin: 0 0 10px 0; font-size: 16px; opacity: 0.9;">ğŸ‘¥ Total Users</h3>
                <div style="font-size: 32px; font-weight: bold;">{{ stats.total_users }}</div>
                <div style="font-size: 12px; opacity: 0.8; margin-top: 5px;">
                    Active: {{ stats.active_users }} | Staff: {{ stats.staff_users }}
                </div>
            </div>
            
            <!-- Bunkers Stats -->
            <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <h3 style="margin: 0 0 10px 0; font-size: 16px; opacity: 0.9;">ğŸ° Total Bunkers</h3>
                <div style="font-size: 32px; font-weight: bold;">{{ stats.total_bunkers }}</div>
                <div style="font-size: 12px; opacity: 0.8; margin-top: 5px;">
                    Verified: {{ stats.verified_bunkers }} | Pending: {{ stats.pending_bunkers }}
                </div>
            </div>
            
            <!-- QSOs Stats -->
            <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <h3 style="margin: 0 0 10px 0; font-size: 16px; opacity: 0.9;">ğŸ“» Total QSOs</h3>
                <div style="font-size: 32px; font-weight: bold;">{{ stats.total_qsos }}</div>
                <div style="font-size: 12px; opacity: 0.8; margin-top: 5px;">
                    Verified: {{ stats.verified_qsos }} | B2B: {{ stats.b2b_qsos }}
                </div>
            </div>
            
            <!-- Diplomas Stats -->
            <div style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <h3 style="margin: 0 0 10px 0; font-size: 16px; opacity: 0.9;">ğŸ† Diplomas Issued</h3>
                <div style="font-size: 32px; font-weight: bold;">{{ stats.total_diplomas }}</div>
                <div style="font-size: 12px; opacity: 0.8; margin-top: 5px;">
                    Active Spots: {{ stats.active_spots }}
                </div>
            </div>
        </div>
        
        {% if stats.auto_created_users > 0 %}
        <div style="background-color: #fff3cd; border: 1px solid #ffc107; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
            <strong>âš ï¸ Attention:</strong> There are <strong>{{ stats.auto_created_users }}</strong> auto-created users waiting to claim their accounts.
            <a href="{% url 'admin:accounts_user_changelist' %}?auto_created__exact=1&is_active__exact=0" style="color: #0066cc; text-decoration: underline;">View them</a>
        </div>
        {% endif %}
        
        {% if stats.superusers < 2 %}
        <div style="background-color: #f8d7da; border: 1px solid #f5c6cb; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
            <strong>ğŸš¨ Security Notice:</strong> Only {{ stats.superusers }} superuser(s) exist. Consider creating a backup superuser account.
        </div>
        {% endif %}
    </div>
    {% endif %}
    
    {% if recent_activations %}
    <div style="margin-bottom: 30px;">
        <h2>ğŸ“¡ Recent Activations</h2>
        <table style="width: 100%; border-collapse: collapse;">
            <thead style="background-color: #f8f9fa;">
                <tr>
                    <th style="padding: 10px; text-align: left; border-bottom: 2px solid #dee2e6;">Date/Time</th>
                    <th style="padding: 10px; text-align: left; border-bottom: 2px solid #dee2e6;">User</th>
                    <th style="padding: 10px; text-align: left; border-bottom: 2px solid #dee2e6;">Bunker</th>
                    <th style="padding: 10px; text-align: left; border-bottom: 2px solid #dee2e6;">Band/Mode</th>
                    <th style="padding: 10px; text-align: center; border-bottom: 2px solid #dee2e6;">B2B</th>
                </tr>
            </thead>
            <tbody>
                {% for activation in recent_activations %}
                <tr style="border-bottom: 1px solid #dee2e6;">
                    <td style="padding: 10px;">{{ activation.activation_date|date:"Y-m-d H:i" }}</td>
                    <td style="padding: 10px;">
                        <a href="{% url 'admin:accounts_user_change' activation.user.id %}">{{ activation.user.callsign }}</a>
                    </td>
                    <td style="padding: 10px;">
                        <a href="{% url 'admin:bunkers_bunker_change' activation.bunker.id %}">{{ activation.bunker.reference_number }}</a>
                    </td>
                    <td style="padding: 10px;">{{ activation.band|default:"-" }} / {{ activation.mode|default:"-" }}</td>
                    <td style="padding: 10px; text-align: center;">
                        {% if activation.is_b2b %}
                        <span style="color: #28a745; font-weight: bold;">âœ“</span>
                        {% else %}
                        -
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}
    
    {% if app_list %}
    <div>
        <h2>ğŸ§© Available Applications</h2>
        {% for app in app_list %}
        <div class="app-{{ app.app_label }} module" style="margin-bottom: 20px; border: 1px solid #ddd; border-radius: 5px; padding: 15px; background-color: #fff;">
            <table>
                <caption style="text-align: left; font-size: 18px; font-weight: bold; margin-bottom: 10px; color: #333;">
                    <a href="{{ app.app_url }}" class="section" title="{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}">{{ app.name }}</a>
                </caption>
                {% for model in app.models %}
                <tr class="model-{{ model.object_name|lower }}">
                    {% if model.admin_url %}
                    <th scope="row"><a href="{{ model.admin_url }}" style="color: #417690; text-decoration: none;">{{ model.name }}</a></th>
                    {% else %}
                    <th scope="row">{{ model.name }}</th>
                    {% endif %}

                    {% if model.add_url %}
                    <td><a href="{{ model.add_url }}" class="addlink" style="color: #417690;">{% translate 'Add' %}</a></td>
                    {% else %}
                    <td>&nbsp;</td>
                    {% endif %}

                    {% if model.admin_url %}
                    {% if model.view_only %}
                    <td><a href="{{ model.admin_url }}" class="viewlink" style="color: #417690;">{% translate 'View' %}</a></td>
                    {% else %}
                    <td><a href="{{ model.admin_url }}" class="changelink" style="color: #417690;">{% translate 'Change' %}</a></td>
                    {% endif %}
                    {% else %}
                    <td>&nbsp;</td>
                    {% endif %}
                </tr>
                {% endfor %}
            </table>
        </div>
        {% endfor %}
    {% else %}
        <p>{% translate 'You don't have permission to view or edit anything.' %}</p>
    {% endif %}
    </div>
</div>
{% endblock %}
